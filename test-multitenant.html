<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šç§Ÿæˆ·åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        button { padding: 8px 15px; margin: 5px; cursor: pointer; }
        input { padding: 5px; margin: 5px; width: 300px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª å¤šç§Ÿæˆ·åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>1. å¥åº·æ£€æŸ¥</h3>
        <button onclick="testHealth()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
        <div id="healthResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>2. APIå¯†é’¥éªŒè¯</h3>
        <input type="text" id="testApiKey" placeholder="è¾“å…¥APIå¯†é’¥è¿›è¡ŒéªŒè¯" value="sk-test123456789012345678901234567890">
        <button onclick="testValidateApiKey()">éªŒè¯APIå¯†é’¥</button>
        <div id="validateResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>3. ç¼“å­˜ç»Ÿè®¡</h3>
        <button onclick="testCacheStats()">è·å–ç¼“å­˜ç»Ÿè®¡</button>
        <div id="cacheStatsResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>4. èŠå¤©æµ‹è¯•ï¼ˆéœ€è¦æœ‰æ•ˆAPIå¯†é’¥ï¼‰</h3>
        <input type="text" id="chatApiKey" placeholder="è¾“å…¥æœ‰æ•ˆçš„DeepSeek APIå¯†é’¥">
        <input type="text" id="chatMessage" placeholder="è¾“å…¥èŠå¤©æ¶ˆæ¯" value="ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±">
        <button onclick="testChat()">æµ‹è¯•èŠå¤©</button>
        <div id="chatResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>5. ç¼“å­˜ç®¡ç†</h3>
        <button onclick="testClearAllCache()">æ¸…é™¤æ‰€æœ‰ç¼“å­˜</button>
        <div id="clearCacheResult" class="result"></div>
    </div>

    <script>
        const baseUrl = 'http://localhost:8080/api';

        async function testHealth() {
            try {
                const response = await fetch(`${baseUrl}/health`);
                const result = await response.text();
                document.getElementById('healthResult').innerHTML = `<strong>æˆåŠŸ:</strong> ${result}`;
            } catch (error) {
                document.getElementById('healthResult').innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        async function testValidateApiKey() {
            const apiKey = document.getElementById('testApiKey').value;
            try {
                const response = await fetch(`${baseUrl}/validate-api-key?apiKey=${encodeURIComponent(apiKey)}`);
                const result = await response.text();
                const status = response.ok ? 'æœ‰æ•ˆ' : 'æ— æ•ˆ';
                document.getElementById('validateResult').innerHTML = `<strong>${status}:</strong> ${result}`;
            } catch (error) {
                document.getElementById('validateResult').innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        async function testCacheStats() {
            try {
                const response = await fetch(`${baseUrl}/cache/stats`);
                const result = await response.text();
                document.getElementById('cacheStatsResult').innerHTML = `<strong>ç¼“å­˜ç»Ÿè®¡:</strong> ${result}`;
            } catch (error) {
                document.getElementById('cacheStatsResult').innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        async function testChat() {
            const apiKey = document.getElementById('chatApiKey').value;
            const message = document.getElementById('chatMessage').value;
            
            if (!apiKey) {
                document.getElementById('chatResult').innerHTML = '<strong>é”™è¯¯:</strong> è¯·å…ˆè¾“å…¥APIå¯†é’¥';
                return;
            }

            try {
                const response = await fetch(`${baseUrl}/chat?prompt=${encodeURIComponent(message)}&apiKey=${encodeURIComponent(apiKey)}`);
                const result = await response.text();
                const status = response.ok ? 'æˆåŠŸ' : 'å¤±è´¥';
                document.getElementById('chatResult').innerHTML = `<strong>${status}:</strong> ${result}`;
            } catch (error) {
                document.getElementById('chatResult').innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        async function testClearAllCache() {
            try {
                const response = await fetch(`${baseUrl}/cache/clear-all`, { method: 'POST' });
                const result = await response.text();
                const status = response.ok ? 'æˆåŠŸ' : 'å¤±è´¥';
                document.getElementById('clearCacheResult').innerHTML = `<strong>${status}:</strong> ${result}`;
            } catch (error) {
                document.getElementById('clearCacheResult').innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•å¥åº·æ£€æŸ¥
        window.onload = function() {
            testHealth();
        };
    </script>
</body>
</html>
